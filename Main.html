<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cyberpunk Portfolio Hub</title>
    <style>
        /* --- CSS STYLING --- */
        :root {
            --neon-blue: #00f3ff;
            --matrix-green: #0f0;
            --dark-bg: #050505;
        }
        body { margin: 0; overflow: hidden; background-color: var(--dark-bg); font-family: 'Courier New', Courier, monospace; }
        
        /* LAYERS */
        #matrix-bg { position: absolute; top: 0; left: 0; z-index: 0; width: 100%; height: 100%; }
        #game-container { position: absolute; top: 0; left: 0; z-index: 1; width: 100%; height: 100%; }
        #ui-layer { position: absolute; top: 0; left: 0; z-index: 10; width: 100%; height: 100%; pointer-events: none; }
        
        /* UI ELEMENTS */
        .hud-text {
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
            position: absolute;
            pointer-events: auto;
        }
        #instructions {
            bottom: 20px; width: 100%; text-align: center;
            font-size: 14px; background: rgba(0,0,0,0.5); padding: 10px;
        }
        
        /* MOBILE CONTROLS */
        #joystick-zone {
            position: absolute; bottom: 50px; left: 50px; width: 120px; height: 120px;
            background: rgba(0, 243, 255, 0.1); border-radius: 50%; display: none; /* Hidden on desktop by default */
            pointer-events: auto; border: 2px solid var(--neon-blue);
        }
        #joystick-knob {
            width: 50px; height: 50px; background: var(--neon-blue); border-radius: 50%;
            position: absolute; top: 35px; left: 35px; box-shadow: 0 0 15px var(--neon-blue);
        }

        /* GALLERY OVERLAY (Hidden by default) */
        #gallery-overlay {
            display: none; position: absolute; top: 0; left: 0; z-index: 20;
            width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9);
            flex-direction: column; align-items: center; justify-content: start;
            padding-top: 50px; overflow-y: auto; pointer-events: auto;
        }
        .gallery-header {
            color: var(--neon-blue); font-size: 2rem; margin-bottom: 30px; text-transform: uppercase;
            border-bottom: 2px solid var(--neon-blue); padding-bottom: 10px; width: 80%; text-align: center;
        }
        .gallery-grid {
            display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; width: 80%; padding-bottom: 50px;
        }
        .project-card {
            width: 250px; height: 200px; background: #111; border: 1px solid #333;
            transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }
        .project-card:hover {
            transform: scale(1.2); z-index: 30;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
        }
        .card-img { width: 100%; height: 140px; background-size: cover; background-position: center; background-color: #222; }
        .card-title { color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 14px; }
        
        .back-btn {
            margin-top: 20px; padding: 10px 30px; background: transparent; border: 2px solid var(--neon-blue);
            color: var(--neon-blue); font-family: inherit; font-weight: bold; cursor: pointer;
            text-transform: uppercase; transition: 0.3s;
        }
        .back-btn:hover { background: var(--neon-blue); color: black; box-shadow: 0 0 15px var(--neon-blue); }

        /* IFRAME WRAPPER (The Tool Viewer) */
        #viewer-overlay {
            display: none; position: absolute; top: 0; left: 0; z-index: 30;
            width: 100%; height: 100%; background: white; flex-direction: column; pointer-events: auto;
        }
        #viewer-header {
            height: 50px; background: #111; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            border-bottom: 2px solid var(--neon-blue);
        }
        #viewer-frame { flex-grow: 1; border: none; width: 100%; }
        .viewer-title { color: white; font-weight: bold; }
        .close-viewer-btn {
            background: #ff3333; color: white; border: none; padding: 5px 15px; cursor: pointer; font-family: inherit;
        }

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <canvas id="matrix-bg"></canvas>

    <div id="game-container"></div>

    <div id="ui-layer">
        <div id="instructions" class="hud-text">
            WASD to Drive â€¢ Drive into portals to view projects
            <br><span style="font-size:10px; opacity:0.7;">(Mobile: Use Joystick)</span>
        </div>
        <div id="joystick-zone"><div id="joystick-knob"></div></div>
    </div>

    <div id="gallery-overlay">
        <div class="gallery-header" id="gallery-title">Projects</div>
        <div class="gallery-grid" id="gallery-grid">
            </div>
        <button class="back-btn" onclick="exitGallery()">Return to World</button>
    </div>

    <div id="viewer-overlay">
        <div id="viewer-header">
            <span class="viewer-title" id="viewer-project-name">Project Name</span>
            <div>
                <button class="close-viewer-btn" onclick="copyLink()">Share Link</button>
                <button class="close-viewer-btn" onclick="closeViewer()">Home</button>
            </div>
        </div>
        <iframe id="viewer-frame" src=""></iframe>
    </div>

    <script>
        /* =========================================
           ADMIN CONFIGURATION AREA
           Add your projects here! 
           ========================================= */
        const portfolioData = [
            {
                id: "ppt-tool",
                title: "PPT to PDF Converter",
                category: "Projects",
                file: "SlideSwift2.0.html", // The actual filename in your folder
                image: "Shark Presentation.jpg" // Screenshot path (or leave empty for gray box)
            },
            {
                id: "bsfl-research",
                title: "BSFL Nutrition Study",
                category: "Academic",
                file: "bsfl-study.html",
                image: "" 
            },
            {
                id: "water-sensor",
                title: "Water Leak Sensor",
                category: "Competitions",
                file: "sensor-demo.html",
                image: ""
            },
            {
                id: "resume",
                title: "My Resume / CV",
                category: "About Me",
                file: "resume.html",
                image: ""
            }
        ];

        /* =========================================
           PART 1: MATRIX BACKGROUND 
           ========================================= */
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');

        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        const cols = Math.floor(width / 20);
        const ypos = Array(cols).fill(0);

        function matrixDraw() {
            ctx.fillStyle = '#0001';
            ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#0f0';
            ctx.font = '15pt monospace';
            
            ypos.forEach((y, ind) => {
                const text = String.fromCharCode(Math.random() * 128);
                const x = ind * 20;
                ctx.fillText(text, x, y);
                if (y > 100 + Math.random() * 10000) ypos[ind] = 0;
                else ypos[ind] = y + 20;
            });
        }
        setInterval(matrixDraw, 50);

        /* =========================================
           PART 2: THREE.JS DRIVING GAME
           ========================================= */
        let scene, camera, renderer, car, roadGroup;
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let velocity = new THREE.Vector3();
        let friction = 0.92;
        let acceleration = 0.8;
        let isDriving = true;

        // Init 3D World
        function initGame() {
            const container = document.getElementById('game-container');
            
            scene = new THREE.Scene();
            // Fog to hide the matrix background slightly at distance
            scene.fog = new THREE.FogExp2(0x050505, 0.008);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 20, 30);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true }); // Alpha true lets Matrix bg show
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(10, 20, 10);
            scene.add(dirLight);

            // Create Car (Simple Boxy Design)
            car = new THREE.Group();
            
            // Body
            const bodyGeo = new THREE.BoxGeometry(2.5, 1, 4);
            const bodyMat = new THREE.MeshPhongMaterial({ color: 0x00f3ff, emissive: 0x001133 });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 1;
            car.add(body);

            // Roof
            const roofGeo = new THREE.BoxGeometry(2, 0.8, 2);
            const roofMat = new THREE.MeshPhongMaterial({ color: 0x111111 });
            const roof = new THREE.Mesh(roofGeo, roofMat);
            roof.position.y = 1.9;
            roof.position.z = -0.5;
            car.add(roof);

            scene.add(car);

            // Create Floating Roads (The "+" Shape)
            roadGroup = new THREE.Group();
            const roadMat = new THREE.MeshPhongMaterial({ color: 0x222222, shininess: 30 });
            const glowMat = new THREE.MeshBasicMaterial({ color: 0x00f3ff });

            // Helper to make a lane
            function createLane(x, z, width, length, labelText, type) {
                // Road Surface
                const plane = new THREE.Mesh(new THREE.BoxGeometry(width, 0.5, length), roadMat);
                plane.position.set(x, -0.25, z);
                roadGroup.add(plane);

                // Glowing edges
                const borderL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.5, length), glowMat);
                borderL.position.set(x - width/2, -0.25, z);
                roadGroup.add(borderL);

                const borderR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.5, length), glowMat);
                borderR.position.set(x + width/2, -0.25, z);
                roadGroup.add(borderR);

                // Gate/Trigger Visual
                const gateGeo = new THREE.TorusGeometry(3, 0.2, 8, 20);
                const gate = new THREE.Mesh(gateGeo, glowMat);
                // Position gate at the end of the lane
                let gx = x, gz = z;
                if(length > width) { gz = z > 0 ? z + length/2 - 2 : z - length/2 + 2; gate.rotation.y = 0; } // North/South
                else { gx = x > 0 ? x + width/2 - 2 : x - width/2 + 2; gate.rotation.y = Math.PI/2; } // East/West
                
                gate.position.set(gx, 3, gz);
                roadGroup.add(gate);

                // We store the trigger zone data in the user data
                gate.userData = { type: type, x: gx, z: gz }; 
            }

            // Central Hub
            createLane(0, 0, 10, 10, "Hub", "hub");
            // North Lane (Projects) - Negative Z
            createLane(0, -30, 8, 50, "Projects", "Projects");
            // South Lane (Academic) - Positive Z
            createLane(0, 30, 8, 50, "Academic", "Academic");
            // East Lane (Competitions) - Positive X
            createLane(30, 0, 50, 8, "Competitions", "Competitions");
            // West Lane (About Me) - Negative X
            createLane(-30, 0, 50, 8, "About Me", "About Me");

            scene.add(roadGroup);
            
            // Add Text Labels (HTML Overlay markers would be better, but let's do simple logic)
            // For simplicity in single file, we rely on the HUD text.

            animate();
        }

        // Logic for checking falling
        function checkPhysics() {
            // Simple bound checking: The road is a cross shape.
            // Center box: x between -5,5 and z between -5,5
            // Z-strip: x between -4,4 and z between -55, 55
            // X-strip: z between -4,4 and x between -55, 55
            
            const x = car.position.x;
            const z = car.position.z;
            let onRoad = false;

            if (Math.abs(x) < 5 && Math.abs(z) < 5) onRoad = true; // Center
            else if (Math.abs(x) < 4 && Math.abs(z) < 55) onRoad = true; // North/South
            else if (Math.abs(z) < 4 && Math.abs(x) < 55) onRoad = true; // East/West

            if (!onRoad) {
                car.position.y -= 0.5; // Fall
                car.rotation.x += 0.1; // Tumble
            } else {
                car.position.y = 0;
                car.rotation.x = 0;
                car.rotation.z = 0;
            }

            // Reset if fallen too far
            if (car.position.y < -20) {
                car.position.set(0, 0, 0);
                velocity.set(0, 0, 0);
                car.rotation.set(0, 0, 0);
            }
        }

        // Logic for Triggers (Enter Gates)
        function checkTriggers() {
            const x = car.position.x;
            const z = car.position.z;
            let category = null;

            // North Gate (Projects) z < -50
            if (z < -50 && Math.abs(x) < 4) category = "Projects";
            // South Gate (Academic) z > 50
            else if (z > 50 && Math.abs(x) < 4) category = "Academic";
            // East Gate (Competitions) x > 50
            else if (x > 50 && Math.abs(z) < 4) category = "Competitions";
            // West Gate (About Me) x < -50
            else if (x < -50 && Math.abs(z) < 4) category = "About Me";

            if (category) {
                openGallery(category);
                // Reset car slightly back so they don't loop trigger instantly on return
                car.position.set(0,0,0); 
                velocity.set(0,0,0);
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isDriving) {
                // Controls
                if (moveForward) velocity.z -= acceleration;
                if (moveBackward) velocity.z += acceleration;
                if (moveLeft) velocity.x -= acceleration;
                if (moveRight) velocity.x += acceleration;

                // Physics
                velocity.multiplyScalar(friction);
                car.position.add(new THREE.Vector3(velocity.x * 0.1, 0, velocity.z * 0.1));

                // Camera Follow
                camera.position.x = car.position.x + (velocity.x * 0.5);
                camera.position.z = car.position.z + 15;
                camera.position.y = 10;
                camera.lookAt(car.position);

                checkPhysics();
                checkTriggers();
            }

            renderer.render(scene, camera);
        }

        initGame();

        /* =========================================
           PART 3: INPUT HANDLING (KEYBOARD & TOUCH)
           ========================================= */
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w': moveForward = true; break;
                case 's': moveBackward = true; break;
                case 'a': moveLeft = true; break;
                case 'd': moveRight = true; break;
            }
        });
        document.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w': moveForward = false; break;
                case 's': moveBackward = false; break;
                case 'a': moveLeft = false; break;
                case 'd': moveRight = false; break;
            }
        });

        // Touch Joystick Logic
        const joyZone = document.getElementById('joystick-zone');
        const joyKnob = document.getElementById('joystick-knob');
        let touchId = null;
        
        // Show joystick only on touch devices usually, but here we force display if needed via CSS or leave it. 
        // Simple detection:
        if ('ontouchstart' in window) {
            joyZone.style.display = 'block';
        }

        joyZone.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchId = e.changedTouches[0].identifier;
            handleJoystick(e.changedTouches[0]);
        });
        joyZone.addEventListener('touchmove', (e) => {
            e.preventDefault();
            for(let i=0; i<e.changedTouches.length; i++) {
                if(e.changedTouches[i].identifier === touchId) handleJoystick(e.changedTouches[i]);
            }
        });
        joyZone.addEventListener('touchend', (e) => {
            e.preventDefault();
            touchId = null;
            joyKnob.style.top = '35px'; joyKnob.style.left = '35px';
            moveForward = moveBackward = moveLeft = moveRight = false;
        });

        function handleJoystick(touch) {
            const rect = joyZone.getBoundingClientRect();
            let x = touch.clientX - rect.left - 60; // -60 is half width
            let y = touch.clientY - rect.top - 60;
            
            // Clamp
            const dist = Math.sqrt(x*x + y*y);
            if(dist > 35) {
                x = (x/dist)*35;
                y = (y/dist)*35;
            }

            joyKnob.style.transform = `translate(${x}px, ${y}px)`;

            // Map to WASD
            moveForward = y < -10;
            moveBackward = y > 10;
            moveLeft = x < -10;
            moveRight = x > 10;
        }


        /* =========================================
           PART 4: UI & NAVIGATION LOGIC
           ========================================= */
        function openGallery(category) {
            isDriving = false;
            document.getElementById('game-container').style.filter = "blur(10px)";
            const overlay = document.getElementById('gallery-overlay');
            overlay.style.display = 'flex';
            
            document.getElementById('gallery-title').innerText = category;
            
            // Populate Items
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = "";
            
            const items = portfolioData.filter(p => p.category === category);
            
            if (items.length === 0) {
                grid.innerHTML = "<div style='color:white'>No artifacts found in this sector.</div>";
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.onclick = () => openTool(item);
                
                // Use a generic placeholder color if no image provided
                const imgStyle = item.image ? `background-image: url('${item.image}')` : `background: linear-gradient(45deg, #111, #333)`;
                
                card.innerHTML = `
                    <div class="card-img" style="${imgStyle}"></div>
                    <div class="card-title">${item.title}</div>
                `;
                grid.appendChild(card);
            });
        }

        function exitGallery() {
            document.getElementById('gallery-overlay').style.display = 'none';
            document.getElementById('game-container').style.filter = "none";
            isDriving = true;
        }

        function openTool(item) {
            const viewer = document.getElementById('viewer-overlay');
            const frame = document.getElementById('viewer-frame');
            const title = document.getElementById('viewer-project-name');

            title.innerText = item.title;
            frame.src = item.file; // Load local file
            viewer.style.display = 'flex';
        }

        function closeViewer() {
            document.getElementById('viewer-overlay').style.display = 'none';
            document.getElementById('viewer-frame').src = "";
        }

        function copyLink() {
            // Since this is a static site, we just copy the main URL
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert("Portfolio Link Copied! (Note: Since files are local/static, this links to the main page)");
            });
        }

        window.addEventListener('resize', () => {
             // Handle resize for both canvas
             width = canvas.width = window.innerWidth;
             height = canvas.height = window.innerHeight;
             camera.aspect = window.innerWidth / window.innerHeight;
             camera.updateProjectionMatrix();
             renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>